<header>
  <div class="left">
    <!-- commented by Cozy
    <app-pop-out></app-pop-out>
    -->
  </div>
  <h1 class="sr-only">{{ "myVault" | i18n }}</h1>
  <div class="search">
    <i class="icon-cozy icon-search"></i>
    <input
      type="{{ searchTypeSearch ? 'search' : 'text' }}"
      placeholder="{{ 'searchVault' | i18n }}"
      id="search"
      [(ngModel)]="searchText"
      (input)="search(200)"
      autocomplete="off"
      appAutofocus
      (keydown)="closeOnEsc($event)"
    />
    <i
      class="icon-cozy icon-cross {{ searchText === '' ? 'invisible' : '' }}"
      aria-hidden="true"
      (click)="emptySearch()"
    ></i>
  </div>
  <div class="right">
    <button type="button" (click)="openWebApp()" appA11yTitle="{{ 'popOutNewWindow' | i18n }}">
      <i class="icon-cozy icon-pop-inside" aria-hidden="true"></i>
    </button>
    <button type="button" appBlurClick (click)="addCipher()" appA11yTitle="{{ 'addItem' | i18n }}">
      <i class="icon-cozy icon-plus" aria-hidden="true"></i>
    </button>
  </div>
</header>
<main tabindex="-1" cdk-scrollable>
  <!-- Cozy customization, Profile migration -->
  <app-profiles-migration
    *ngIf="ciphers && ciphers.length"
    [profilesCount]="this.typeCounts.get(cipherType.Identity) || 0"
  ></app-profiles-migration>
  <!-- Cozy customization end -->
  <!-- commented by Cozy
  <app-vault-select
    (onVaultSelectionChanged)="vaultFilterChanged()"
    class="select-index-top"
  ></app-vault-select>
  -->
  <div class="no-items" *ngIf="(!ciphers || !ciphers.length) && !showSearching()">
    <i class="bwi bwi-spinner bwi-spin bwi-3x" *ngIf="!loaded"></i>
    <ng-container *ngIf="loaded">
      <img class="no-items-image" aria-hidden="true" />
      <p>{{ "noItemsInList" | i18n }}</p>
      <button type="button" (click)="addCipher()" class="btn block primary link">
        {{ "addItem" | i18n }}
      </button>
    </ng-container>
  </div>
  <ng-container *ngIf="ciphers && ciphers.length && !showSearching()">
    <div class="box list" *ngIf="favoriteCiphers">
      <h2 class="box-header">
        {{ "favorites" | i18n }}
        <!-- Cozy custo : commented
        <span class="flex-right">{{ favoriteCiphers.length }}</span>
        -->
      </h2>
      <div class="box-content">
        <app-cipher-row
          *ngFor="let favoriteCipher of favoriteCiphers"
          [cipher]="favoriteCipher"
          title="{{ 'viewItem' | i18n }}"
          (onSelected)="selectCipher($event)"
          (launchEvent)="launchCipher($event)"
          [showView]="true"
        >
        </app-cipher-row>
      </div>
    </div>
    <div class="box list">
      <h2 class="box-header">
        {{ "types" | i18n }}
        <!-- commented by Cozy
        <span class="flex-right">4</span>
        -->
      </h2>
      <div class="box-content single-line underline">
        <!-- Cozy custo : add a "for this web site" row -->
        <button
          type="button"
          class="box-content-row"
          appStopClick
          appBlurClick
          (click)="selectCurrent()"
        >
          <div class="row-main">
            <div class="icon"><i class="icon-cozy icon-search"></i></div>
            <span class="text">{{ "forThisWebSite" | i18n }}</span>
          </div>
          <span class="row-sub-label">{{ cipherNumberForCurrentTab }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
        <!-- end custo -->
        <button
          type="button"
          class="box-content-row"
          appStopClick
          appBlurClick
          (click)="selectType(cipherType.Login)"
        >
          <div class="row-main">
            <div class="icon"><i class="icon-cozy icon-login"></i></div>
            <span class="text">{{ "typeLogin" | i18n }}</span>
          </div>
          <span class="row-sub-label">{{ this.typeCounts.get(cipherType.Login) || 0 }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
        <button
          type="button"
          class="box-content-row"
          appStopClick
          appBlurClick
          (click)="selectType(cipherType.Card)"
        >
          <div class="row-main">
            <div class="icon"><i class="icon-cozy icon-card"></i></div>
            <span class="text">{{ "typeCard" | i18n }}</span>
          </div>
          <span class="row-sub-label">{{ this.typeCounts.get(cipherType.Card) || 0 }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
        <button
          type="button"
          class="box-content-row"
          appStopClick
          appBlurClick
          (click)="selectType(cipherType.Identity)"
        >
          <div class="row-main">
            <div class="icon"><i class="icon-cozy icon-identity"></i></div>
            <span class="text">{{ "typeIdentity" | i18n }}</span>
          </div>
          <span class="row-sub-label">{{ this.typeCounts.get(cipherType.Identity) || 0 }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
        <!-- Cozy customization ; display Contact type row -->
        <button
          type="button"
          class="box-content-row"
          appStopClick
          appBlurClick
          (click)="selectType(cipherType.Contact)"
        >
          <div class="row-main">
            <div class="icon"><i class="icon-cozy icon-identity"></i></div>
            <span class="text">{{ "typeContacts" | i18n }}</span>
          </div>
          <span class="row-sub-label">{{ this.typeCounts.get(cipherType.Contact) || 0 }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
        <!-- Cozy customization end -->
        <!-- Cozy customization ; display Paper type row -->
        <button
          type="button"
          class="box-content-row"
          appStopClick
          appBlurClick
          (click)="selectType(cipherType.Paper)"
        >
          <div class="row-main">
            <div class="icon"><i class="icon-cozy icon-mespapiers"></i></div>
            <span class="text">{{ "typePapers" | i18n }}</span>
          </div>
          <span class="row-sub-label">{{ this.typeCounts.get(cipherType.Paper) || 0 }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
        <!-- Cozy customization end -->
        <button
          type="button"
          class="box-content-row"
          appStopClick
          appBlurClick
          (click)="selectType(cipherType.SecureNote)"
          *ngIf="this.typeCounts.get(cipherType.SecureNote)"
        >
          <div class="row-main">
            <div class="icon"><i class="icon-cozy icon-note"></i></div>
            <span class="text">{{ "typeSecureNote" | i18n }}</span>
          </div>
          <span class="row-sub-label">{{ this.typeCounts.get(cipherType.SecureNote) || 0 }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
      </div>
    </div>
    <!-- commented by Cozy (Folders are collections in Cozy)
    <div class="box list" *ngIf="nestedFolders?.length">
      <h2 class="box-header">
        {{ "folders" | i18n }}
        <span class="flex-right">{{ folderCount }}</span>
      </h2>
      <div class="box-content single-line">
        <button
          type="button"
          *ngFor="let f of nestedFolders"
          class="box-content-row"
          appStopClick
          (click)="selectFolder(f.node)"
        >
          <div class="row-main">
            <div class="icon">
              <i class="bwi bwi-fw bwi-lg bwi-folder"></i>
            </div>
            <span class="text">{{ f.node.name }}</span>
          </div>
          <span class="row-sub-label">{{ folderCounts.get(f.node.id) || 0 }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
      </div>
    </div>
    -->
    <!-- in Cozy, folders are collections -->
    <div class="box list" *ngIf="nestedCollections && nestedCollections.length">
      <h2 class="box-header">
        {{ "folders" | i18n }}
        <!--
        <span class="flex-right">{{ nestedCollections.length }}</span>
        -->
      </h2>
      <div class="box-content single-line underline">
        <button
          type="button"
          *ngFor="let nestedCollection of nestedCollections"
          class="box-content-row"
          appStopClick
          appBlurClick
          (click)="selectCollection(nestedCollection.node)"
        >
          <div class="row-main">
            <!-- Cozy custo
            <div class="icon"><i class="bwi bwi-fw bwi-lg bwi-collection"></i></div>
            -->
            <div class="icon">
              <i class="icon-cozy icon-folder"></i>
            </div>
            <!-- end custo -->
            <span class="text">{{ nestedCollection.node.name }}</span>
          </div>
          <span class="row-sub-label">{{
            collectionCounts.get(nestedCollection.node.id) || 0
          }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
        <!-- Cozy custo : add a trash line -->
        <button type="button" class="box-content-row" *ngIf="deletedCount" (click)="selectTrash()">
          <div class="row-main">
            <div class="icon"><i class="icon-cozy icon-trash"></i></div>
            <span class="text">{{ "trash" | i18n }}</span>
          </div>
          <span class="row-sub-label">{{ deletedCount }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
        <!-- end custo -->
      </div>
    </div>
    <div class="box list" *ngIf="showNoFolderCiphers">
      <h2 class="box-header">
        {{ "noneFolder" | i18n }}
        <div class="flex-right">{{ noFolderCiphers.length }}</div>
      </h2>
      <div class="box-content">
        <app-cipher-row
          *ngFor="let noFolderCipher of noFolderCiphers"
          [cipher]="noFolderCipher"
          title="{{ 'viewItem' | i18n }}"
          (onSelected)="selectCipher($event)"
          (launchEvent)="launchCipher($event)"
        >
        </app-cipher-row>
      </div>
    </div>
    <!-- commented by Cozy
    <div class="box list" *ngIf="deletedCount">
      <h2 class="box-header">
        {{ "trash" | i18n }}
        <span class="flex-right">{{ deletedCount }}</span>
      </h2>
      <div class="box-content single-line">
        <button type="button" class="box-content-row" appStopClick (click)="selectTrash()">
          <div class="row-main">
            <div class="icon"><i class="bwi bwi-fw bwi-lg bwi-trash"></i></div>
            <span class="text">{{ "trash" | i18n }}</span>
          </div>
          <span class="row-sub-label">{{ deletedCount }}</span>
          <span><i class="bwi bwi-angle-right bwi-lg row-sub-icon"></i></span>
        </button>
      </div>
    </div>
    -->
  </ng-container>
  <ng-container *ngIf="showSearching()">
    <div class="no-items" *ngIf="!ciphers || !ciphers.length">
      <p>{{ "noItemsInList" | i18n }}</p>
    </div>
    <cdk-virtual-scroll-viewport
      itemSize="55"
      minBufferPx="400"
      maxBufferPx="600"
      *ngIf="ciphers && ciphers.length > 0"
    >
      <div class="box list full-list">
        <div class="box-content">
          <app-cipher-row
            *cdkVirtualFor="let searchedCipher of ciphers"
            [cipher]="searchedCipher"
            title="{{ 'viewItem' | i18n }}"
            (onSelected)="selectCipher($event)"
            (launchEvent)="launchCipher($event)"
          >
          </app-cipher-row>
        </div>
      </div>
    </cdk-virtual-scroll-viewport>
  </ng-container>
</main>
